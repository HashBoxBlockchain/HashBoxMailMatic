"use strict";class Zoom{constructor(){this.zoomState={canvas:null,ctx:null,img:null}}startZoom(t,o){this.zoomState={...this.zoomState,canvas:document.getElementById(t)},this.zoomState.canvas.width=window.innerWidth,this.zoomState.canvas.height=window.innerHeight,this.zoomState={...this.zoomState,ctx:this.zoomState.canvas.getContext("2d")},this.trackTransforms(this.zoomState.ctx),this.zoomState={...this.zoomState,img:new Image},this.zoomState.img.src=o,this.zoomState.img.addEventListener("load",this.redraw,!1);let e=this.zoomState.canvas.width/2,a=this.zoomState.canvas.height/2,n,s,r=(this.zoomState.canvas.addEventListener("mousedown",function(t){document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",e=t.offsetX||t.pageX-zoom.zoomState.canvas.offsetLeft,a=t.offsetY||t.pageY-zoom.zoomState.canvas.offsetTop,n=zoom.zoomState.ctx.transformedPoint(e,a),s=!1},!1),this.zoomState.canvas.addEventListener("mousemove",function(t){e=t.offsetX||t.pageX-zoom.zoomState.canvas.offsetLeft,a=t.offsetY||t.pageY-zoom.zoomState.canvas.offsetTop,s=!0,n&&(t=zoom.zoomState.ctx.transformedPoint(e,a),zoom.zoomState.ctx.translate(t.x-n.x,t.y-n.y),zoom.redraw())},!1),this.zoomState.canvas.addEventListener("mouseup",function(t){n=null,s||m(t.shiftKey?-1:1)},!1),1.1),m=function(t){var o=zoom.zoomState.ctx.transformedPoint(e,a),t=(zoom.zoomState.ctx.translate(o.x,o.y),Math.pow(r,t));zoom.zoomState.ctx.scale(t,t),zoom.zoomState.ctx.translate(-o.x,-o.y),zoom.redraw()};function i(t){var o=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;return o&&m(o),t.preventDefault()&&!1}this.zoomState.canvas.addEventListener("DOMMouseScroll",i,!1),this.zoomState.canvas.addEventListener("mousewheel",i,!1)}trackTransforms(m){const i=document.createElementNS("http://www.w3.org/2000/svg","svg");let c=i.createSVGMatrix();m.getTransform=function(){return c};const t=[],o=m.save;m.save=function(){return t.push(c.translate(0,0)),o.call(m)};let e=m.restore,a=(m.restore=function(){return c=t.pop(),e.call(m)},m.scale),n=(m.scale=function(t,o){return c=c.scaleNonUniform(t,o),a.call(m,t,o)},m.rotate),s=(m.rotate=function(t){return c=c.rotate(180*t/Math.PI),n.call(m,t)},m.translate),h=(m.translate=function(t,o){return c=c.translate(t,o),s.call(m,t,o)},m.transform),r=(m.transform=function(t,o,e,a,n,s){const r=i.createSVGMatrix();return r.a=t,r.b=o,r.c=e,r.d=a,r.e=n,r.f=s,c=c.multiply(r),h.call(m,t,o,e,a,n,s)},m.setTransform),l=(m.setTransform=function(t,o,e,a,n,s){return c.a=t,c.b=o,c.c=e,c.d=a,c.e=n,c.f=s,r.call(m,t,o,e,a,n,s)},i.createSVGPoint());m.transformedPoint=function(t,o){return l.x=t,l.y=o,l.matrixTransform(c.inverse())}}redraw(){var t=zoom.zoomState.ctx.transformedPoint(0,0),o=zoom.zoomState.ctx.transformedPoint(zoom.zoomState.canvas.width,zoom.zoomState.canvas.height);zoom.zoomState.ctx.clearRect(t.x,t.y,o.x-t.x,o.y-t.y),zoom.drawImageScaled(zoom.zoomState.img,zoom.zoomState.ctx)}drawImageScaled(t,o){var e=o.canvas,a=e.width/t.width,n=e.height/t.height,a=Math.min(a,n),n=(e.width-t.width*a)/2,s=(e.height-t.height*a)/2;o.clearRect(0,0,e.width,e.height),o.drawImage(t,0,0,t.width,t.height,n,s,t.width*a,t.height*a)}}const zoom=new Zoom;export{Zoom,zoom};